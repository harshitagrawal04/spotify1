"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[5523],{52408:(e,t,a)=>{a.r(t),a.d(t,{default:()=>de});var r=a(30758),i=a(85387);const n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let o;const s=new Uint8Array(16);function l(){if(!o&&(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!o))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(s)}const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function d(e,t=0){return c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]}const u=function(e,t,a){if(n.randomUUID&&!t&&!e)return n.randomUUID();const r=(e=e||{}).random||(e.rng||l)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=r[e];return t}return d(r)};var h=a(33100),g=a(79252),I=a(18587),p=a(30618),S=a(63519);var E=a(18906),f=a(3332),T=a(51956),N=a.n(T);let m=null;const b=(0,a(77808).h)();function y(e){const t=(0,E.S)((e=>e.setStatus)),[a,i]=(0,r.useState)(""),n=(0,r.useCallback)((async()=>{if(e){t(f.Z.AUTHENTICATION_STARTED);const a=await C(e).catch((e=>{throw(m||(m=T.logger),m).error("error: could not fetch IDT token!"),t(f.Z.AUTHENTICATION_FAILED),e}));a&&(t(f.Z.AUTHENTICATION_SUCCEEDED),i(a.accessToken))}}),[e,t]);return(0,r.useEffect)((()=>{e&&n()}),[e,n]),a}async function C(e){if(!e)return;const t=new URL("sp://auth/v1/token_web_auth");return t.searchParams.append("audience",e),await b.get(t.toString())}var v=a(45005),w=a(35953);var D=a(62411),k=a(33924);var O=a(63710);function L(e,t){const a=(0,r.useRef)(),i=function(){const e=(0,r.useRef)(),t=(0,E.S)((e=>e.setStatus)),a=(0,r.useCallback)((()=>{t(f.Z.PAGE_LOAD_STARTED),e.current=setTimeout((()=>{N().error("[The Stage] Message handshake timeout (5s)"),t(f.Z.PAGE_LOAD_FAILED)}),5e3)}),[t]),i=(0,r.useCallback)((()=>{clearTimeout(e.current)}),[]),n=(0,r.useCallback)((()=>{t(f.Z.PAGE_LOAD_SUCCEEDED),i()}),[t,i]);return(0,r.useMemo)((()=>({handleStarted:a,handleClear:i,handleCompleted:n})),[i,n,a])}(),n=function(){const e=(0,k.g)(),t=(0,D.d4)((e=>e.ui.history.canGoBack));return(0,r.useCallback)((()=>{e(t?-1:"/")}),[e,t])}(),o=(()=>{const e=(0,E.S)((e=>e.setStatus)),{enqueueSnackbar:t}=(0,w.d)(),a=(0,r.useCallback)((()=>{t(g.Ru.get("feedback.link-copied")),e(f.Z.SHARE_EVENT)}),[t,e]),i=(0,r.useCallback)((a=>{t(g.Ru.get("error.generic")),e(f.Z.ERROR)}),[t,e]);return(0,r.useMemo)((()=>({onSuccess:a,onError:i})),[a,i])})(),s=(()=>{const e=(0,E.S)((e=>e.setStatus)),t=(0,E.S)((e=>e.setMessage));return{handleWebEvent:(0,r.useCallback)((a=>{t(a),e(f.Z.WEB_EVENT)}),[t,e])}})(),l=(0,r.useCallback)((r=>{if(!e.includes(r.origin))return;const l=JSON.parse(r.data);"didRequestInitialize"===l.type?(a.current={source:r.source,options:{targetOrigin:r.origin}},function(e){const{source:t,options:a}=e,r=JSON.stringify({type:"ready",capabilities:{}});t.postMessage(r,a)}(a.current),i.handleCompleted()):"didRequestIDToken"===l.type?(a.current={source:r.source,options:{targetOrigin:r.origin}},async function(e,t){const{source:a,options:r}=e,i=await C(t);if(!i)return;if(!i.accessToken)return;const n=JSON.stringify({type:"didReceiveIDToken",token:i.accessToken});a.postMessage(n,r)}(a.current,t)):"didRequestClose"===l.type?n():"didRequestShare"===l.type?async function(e,t,a){const{source:r,options:i}=e;if("didRequestShare"!==t.type)return;let n;const o=(0,v.o_h)(t.url);o&&(n=o.toURL());await(0,O.l)(n).catch((e=>{throw a.onError(e),e})),a.onSuccess();const s={type:"didDismissShare",requestId:t.requestId};r.postMessage(JSON.stringify(s),i)}(a.current,l,o):"didSendEvent"===l.type&&function(e,t){if("didSendEvent"!==e.type)return;const a={category:e.category,action:e.action,label:e.label,value:e.value};t.handleWebEvent(a)}(l,s)}),[e,t,i,n,o,s]);(0,r.useEffect)((()=>(window.addEventListener("message",l),i.handleStarted(),()=>{window.removeEventListener("message",l),i.handleClear()})),[l,i])}var A=a(31773),R=a(23644);let P=function(e){return e[e.NONE=0]="NONE",e[e.STT=1]="STT",e[e.IDT=2]="IDT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function U(e){switch(e){case 0:case"NONE":return P.NONE;case 1:case"STT":return P.STT;case 2:case"IDT":return P.IDT;default:return P.UNRECOGNIZED}}let _=function(e){return e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.ACTIVE=2]="ACTIVE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function M(e){switch(e){case 0:case"INVALID":return _.INVALID;case 1:case"VALID":return _.VALID;case 2:case"ACTIVE":return _.ACTIVE;default:return _.UNRECOGNIZED}}let B=function(e){return e[e.ALCOHOL=0]="ALCOHOL",e[e.ENERGY_DRINKS=1]="ENERGY_DRINKS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});const G={fromJSON:e=>({id:V(e.id)?globalThis.String(e.id):"0",campaignId:V(e.campaignId)?globalThis.String(e.campaignId):"0",lookupToken:V(e.lookupToken)?globalThis.String(e.lookupToken):"",url:V(e.url)?globalThis.String(e.url):"",authType:V(e.authType)?U(e.authType):0,clientId:V(e.clientId)?globalThis.String(e.clientId):void 0,hasAudio:!!V(e.hasAudio)&&globalThis.Boolean(e.hasAudio),status:V(e.status)?M(e.status):0,restricted:!!V(e.restricted)&&globalThis.Boolean(e.restricted),gcpProjectId:V(e.gcpProjectId)?globalThis.String(e.gcpProjectId):"",defaultLocale:V(e.defaultLocale)?globalThis.String(e.defaultLocale):"",restrictions:globalThis.Array.isArray(e?.restrictions)?e.restrictions.map((e=>function(e){switch(e){case 0:case"ALCOHOL":return B.ALCOHOL;case 1:case"ENERGY_DRINKS":return B.ENERGY_DRINKS;default:return B.UNRECOGNIZED}}(e))):[],enableLegacySharing:!!V(e.enableLegacySharing)&&globalThis.Boolean(e.enableLegacySharing),hidePlayer:!!V(e.hidePlayer)&&globalThis.Boolean(e.hidePlayer),legacyBackBehavior:!!V(e.legacyBackBehavior)&&globalThis.Boolean(e.legacyBackBehavior),enableCheckout:!!V(e.enableCheckout)&&globalThis.Boolean(e.enableCheckout),allowedCountries:globalThis.Array.isArray(e?.allowedCountries)?e.allowedCountries.map((e=>globalThis.String(e))):[],restoreOnKilled:!!V(e.restoreOnKilled)&&globalThis.Boolean(e.restoreOnKilled),enableMediaDevices:!!V(e.enableMediaDevices)&&globalThis.Boolean(e.enableMediaDevices)}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.campaignId&&(t.campaignId=e.campaignId),""!==e.lookupToken&&(t.lookupToken=e.lookupToken),""!==e.url&&(t.url=e.url),0!==e.authType&&(t.authType=function(e){switch(e){case P.NONE:return"NONE";case P.STT:return"STT";case P.IDT:return"IDT";case P.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.authType)),void 0!==e.clientId&&(t.clientId=e.clientId),!1!==e.hasAudio&&(t.hasAudio=e.hasAudio),0!==e.status&&(t.status=function(e){switch(e){case _.INVALID:return"INVALID";case _.VALID:return"VALID";case _.ACTIVE:return"ACTIVE";case _.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.status)),!1!==e.restricted&&(t.restricted=e.restricted),""!==e.gcpProjectId&&(t.gcpProjectId=e.gcpProjectId),""!==e.defaultLocale&&(t.defaultLocale=e.defaultLocale),e.restrictions?.length&&(t.restrictions=e.restrictions.map((e=>function(e){switch(e){case B.ALCOHOL:return"ALCOHOL";case B.ENERGY_DRINKS:return"ENERGY_DRINKS";case B.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e)))),!1!==e.enableLegacySharing&&(t.enableLegacySharing=e.enableLegacySharing),!1!==e.hidePlayer&&(t.hidePlayer=e.hidePlayer),!1!==e.legacyBackBehavior&&(t.legacyBackBehavior=e.legacyBackBehavior),!1!==e.enableCheckout&&(t.enableCheckout=e.enableCheckout),e.allowedCountries?.length&&(t.allowedCountries=e.allowedCountries),!1!==e.restoreOnKilled&&(t.restoreOnKilled=e.restoreOnKilled),!1!==e.enableMediaDevices&&(t.enableMediaDevices=e.enableMediaDevices),t},create:e=>G.fromPartial(e??{}),fromPartial(e){const t={id:"0",campaignId:"0",lookupToken:"",url:"",authType:0,clientId:void 0,hasAudio:!1,status:0,restricted:!1,gcpProjectId:"",defaultLocale:"",restrictions:[],enableLegacySharing:!1,hidePlayer:!1,legacyBackBehavior:!1,enableCheckout:!1,allowedCountries:[],restoreOnKilled:!1,enableMediaDevices:!1};return t.id=e.id??"0",t.campaignId=e.campaignId??"0",t.lookupToken=e.lookupToken??"",t.url=e.url??"",t.authType=e.authType??0,t.clientId=e.clientId??void 0,t.hasAudio=e.hasAudio??!1,t.status=e.status??0,t.restricted=e.restricted??!1,t.gcpProjectId=e.gcpProjectId??"",t.defaultLocale=e.defaultLocale??"",t.restrictions=e.restrictions?.map((e=>e))||[],t.enableLegacySharing=e.enableLegacySharing??!1,t.hidePlayer=e.hidePlayer??!1,t.legacyBackBehavior=e.legacyBackBehavior??!1,t.enableCheckout=e.enableCheckout??!1,t.allowedCountries=e.allowedCountries?.map((e=>e))||[],t.restoreOnKilled=e.restoreOnKilled??!1,t.enableMediaDevices=e.enableMediaDevices??!1,t}};const Z={fromJSON:e=>({site:V(e.site)?G.fromJSON(e.site):void 0}),toJSON(e){const t={};return void 0!==e.site&&(t.site=G.toJSON(e.site)),t},create:e=>Z.fromPartial(e??{}),fromPartial(e){const t={site:void 0};return t.site=void 0!==e.site&&null!==e.site?G.fromPartial(e.site):void 0,t}};function V(e){return null!=e}var J=a(81907);const K={fromJSON:e=>({id:q(e.id)?globalThis.String(e.id):"0",siteId:q(e.siteId)?globalThis.String(e.siteId):"0",title:q(e.title)?globalThis.String(e.title):"",description:q(e.description)?globalThis.String(e.description):"",previewImageUrl:q(e.previewImageUrl)?globalThis.String(e.previewImageUrl):"",locale:q(e.locale)?globalThis.String(e.locale):"",height:q(e.height)?globalThis.Number(e.height):void 0,width:q(e.width)?globalThis.Number(e.width):void 0}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.siteId&&(t.siteId=e.siteId),""!==e.title&&(t.title=e.title),""!==e.description&&(t.description=e.description),""!==e.previewImageUrl&&(t.previewImageUrl=e.previewImageUrl),""!==e.locale&&(t.locale=e.locale),void 0!==e.height&&(t.height=Math.round(e.height)),void 0!==e.width&&(t.width=Math.round(e.width)),t},create:e=>K.fromPartial(e??{}),fromPartial(e){const t={id:"0",siteId:"0",title:"",description:"",previewImageUrl:"",locale:"",height:void 0,width:void 0};return t.id=e.id??"0",t.siteId=e.siteId??"0",t.title=e.title??"",t.description=e.description??"",t.previewImageUrl=e.previewImageUrl??"",t.locale=e.locale??"",t.height=e.height??void 0,t.width=e.width??void 0,t}};const j={fromJSON:e=>({metadata:q(e.metadata)?K.fromJSON(e.metadata):void 0}),toJSON(e){const t={};return void 0!==e.metadata&&(t.metadata=K.toJSON(e.metadata)),t},create:e=>j.fromPartial(e??{}),fromPartial(e){const t={metadata:void 0};return t.metadata=void 0!==e.metadata&&null!==e.metadata?K.fromPartial(e.metadata):void 0,t}};function q(e){return null!=e}var H=a(68265);const x=18e5,Y=6e5,F={all:["vtec"],sites:()=>[...F.all,"site"],site:e=>[...F.sites(),e],siteMetadata:(e,t)=>[...F.site(e),t]},$=e=>{const{onStart:t,onError:a,onSuccess:r}=(()=>{const e=(0,E.S)((e=>e.setStatus));return{onStart:()=>e(f.Z.RESOLVING_SITE_STARTED),onSuccess:()=>e(f.Z.RESOLVING_SITE_SUCCEEDED),onError:t=>{e(f.Z.RESOLVING_SITE_FAILED)}}})(),{data:i,error:n,isPending:o,isSuccess:s}=(0,A.I)({queryKey:F.site(e),queryFn:async()=>(t(),await(async(e,t)=>await e.build().withHost(`${J.sp}`).withMethod("GET").withoutMarket().withPath(`/site/${t}`).withEndpointIdentifier("/site/{lookupId}").withJsonContentType().send().then((e=>({...e,body:Z.fromJSON(e.body)}))))(H.n.getInstance(),e)),select:e=>e.body.site,staleTime:Y,gcTime:x});if(n)throw a(n),n;const l=g.Ru.getLocaleForTranslation(),{data:c,error:d,isPending:u,isSuccess:h}=(0,A.I)({queryKey:F.siteMetadata(e,l),queryFn:i?.defaultLocale?async()=>{const t=await(async(e,t,a)=>await e.build().withHost(`${J.sp}`).withMethod("GET").withoutMarket().withPath(`/sites/${t}/metadata/${a}`).withEndpointIdentifier("/sites/{lookupId}/metadata/{localeCode}").withJsonContentType().send().then((e=>({...e,body:j.fromJSON(e.body)}))))(H.n.getInstance(),e,l);return r(),t}:R.hT,select:e=>e.body.metadata,enabled:!!i?.defaultLocale,staleTime:Y,gcTime:x});if(d)throw a(d),d;return{site:i,isSiteSuccess:s,siteMetadata:c,isSiteMetadataSuccess:h,isPending:o||u}},W="NWSmcn03uY8Fosh_mYCi",z="N9ngMcd9oSDEd8zK5jBj",X="kYOJhuJ996EIMXFJD3By";var Q=a(86070);const ee=()=>{const{lookupToken:e=""}=(0,i.g)(),{site:t,siteMetadata:a}=$(e);if(!t||!a)throw new Error(`[The Stage]: Missing data for site: ${e}`);L(t.url,t.clientId);const r=y(t.clientId),n=(()=>{const e=(0,S.k)();if(!e)return;const{containerVersion:t}=e;return t.substring(0,t.lastIndexOf("."))})();let o="";return t.url&&n&&(o=function(e,t,a){const r=new URL(e);r.searchParams.append("utm_app_version",t),a&&(r.hash=`#id_token=${a}`);return r.toString()}(t.url,n,r)),(0,Q.jsx)("div",{className:W,children:(0,Q.jsx)("iframe",{title:a.title,name:"stage-view-frame",id:z,src:o,sandbox:"allow-scripts allow-same-origin"})})};var te=a(97500),ae=a.n(te),re=a(743);var ie=a(64232),ne=a(66108),oe=a(39736);const se=ne.$S.PANEL_CLOSE_CLICK;var le=a(65882);var ce=a(17145);const de=e=>{(()=>{const{scrollNodeChildRef:e}=(0,r.useContext)(re.bi);(0,r.useEffect)((()=>{const t=e?.current,a=e?.current?.className;return t&&(t.className=ae()(a,X)),()=>{t&&(t.className=ae()(a))}}),[e])})(),(()=>{const{isActive:e,panelSend:t}=(0,ie.AI)(oe.Z.NowPlayingView);e&&t(se)})(),function(){const e=(0,le.z)();e.getState()?.hasContext&&!e.getState()?.isPaused&&e.pause({featureIdentifier:"the-stage"})}();const{lookupToken:t=""}=(0,i.g)(),{isPending:a}=$(t),[n]=(0,r.useState)(u());((e,t)=>{const a=(0,E.S)((e=>e.setStatus)),i=(0,E.S)((e=>e.setSession)),n=(0,E.S)((e=>e.resetSession)),o=(0,r.useCallback)(a,[a]),s=(0,r.useCallback)(i,[i]),l=(0,r.useCallback)(n,[n]);(0,r.useEffect)((()=>(s({siteId:e,sessionId:t,startTime:Date.now()}),o(f.Z.PRESENTED),()=>{o(f.Z.DISMISSED),l()})),[l,s,o,t,e])})(t,n);return(0,h.NC)(ce.n2U)?(0,Q.jsx)(I.s,{children:a?(0,Q.jsx)(p.LoadingPage,{hasError:!1,errorMessage:g.Ru.get("error.generic")}):(0,Q.jsx)(ee,{})}):(0,Q.jsx)(p.LoadingPage,{hasError:!0,errorMessage:g.Ru.get("error.not_found.title.page")})}},63519:(e,t,a)=>{a.d(t,{k:()=>n});var r=a(30758),i=a(70392);function n(){const e=(0,i.t)(),[t,a]=(0,r.useState)(null);return(0,r.useEffect)((()=>{let t=!0;return e.getVersionInfo().then((e=>{t&&a(e)})),()=>{t=!1}}),[e,a]),t}}}]);
//# sourceMappingURL=xpui-routes-stage-page.js.map